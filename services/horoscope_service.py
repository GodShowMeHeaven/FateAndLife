from services.openai_service import ask_openai
import random

def get_horoscope(sign: str, period: str = "—Å–µ–≥–æ–¥–Ω—è") -> str:
    """–ü–æ–ª—É—á–∞–µ—Ç –≥–æ—Ä–æ—Å–∫–æ–ø —á–µ—Ä–µ–∑ OpenAI API –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –∫—Ä–∞—Å–∏–≤–æ."""
    prompt = (
        f"–ù–∞–ø–∏—à–∏ —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è –∑–Ω–∞–∫–∞ {sign} –Ω–∞ {period}. "
        "–î–æ–±–∞–≤—å –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏, —Å–æ–≤–µ—Ç—ã, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ —Å–∏–º–≤–æ–ª–∏–∫—É."
    )
    response = ask_openai(prompt)

    formatted_horoscope = (
        f"üîÆ *–ì–æ—Ä–æ—Å–∫–æ–ø –¥–ª—è {sign.capitalize()} –Ω–∞ {period}*\n\n"
        f"üìÖ *–î–∞—Ç–∞:* _{period}_\n"
        f"‚ú® *–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ:* _{response}_\n"
        f"üí° *–°–æ–≤–µ—Ç –¥–Ω—è:* –î–æ–≤–µ—Ä—å—Ç–µ—Å—å –∏–Ω—Ç—É–∏—Ü–∏–∏, –∑–Ω–∞–∫–∏ —Å—É–¥—å–±—ã –≤–æ–∫—Ä—É–≥ –≤–∞—Å.\n"
        f"üî¢ *–°—á–∞—Å—Ç–ª–∏–≤–æ–µ —á–∏—Å–ª–æ:* {random.randint(1, 99)}\n"
        f"üé® *–°—á–∞—Å—Ç–ª–∏–≤—ã–π —Ü–≤–µ—Ç:* {random.choice(['üîµ –°–∏–Ω–∏–π', 'üî¥ –ö—Ä–∞—Å–Ω—ã–π', 'üü¢ –ó–µ–ª–µ–Ω—ã–π', 'üü° –ñ–µ–ª—Ç—ã–π'])}\n"
    )

    return formatted_horoscope
