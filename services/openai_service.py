import openai
import config
import random
import os
# –ü–æ–¥–∫–ª—é—á–∞–µ–º OpenAI API-–∫–ª—é—á
openai.api_key = config.OPENAI_API_KEY
# –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç –¢–∞—Ä–æ
tarot_cards = [
    "–®—É—Ç", "–ú–∞–≥", "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä",
    "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "–û—Ç—à–µ–ª—å–Ω–∏–∫",
    "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "–°–∏–ª–∞", "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "–°–º–µ—Ä—Ç—å", "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
    "–î—å—è–≤–æ–ª", "–ë–∞—à–Ω—è", "–ó–≤–µ–∑–¥–∞", "–õ—É–Ω–∞", "–°–æ–ª–Ω—Ü–µ", "–°—É–¥", "–ú–∏—Ä"
]

def get_tarot_interpretation() -> str:
    """–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É OpenAI –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Å–ª—É—á–∞–π–Ω–æ–π –∫–∞—Ä—Ç—ã –¢–∞—Ä–æ."""
    card = random.choice(tarot_cards)
    prompt = (
        f"–í—ã—Ç–∞—â–∏ –∫–∞—Ä—Ç—É –¢–∞—Ä–æ: {card}. –û–±—ä—è—Å–Ω–∏ –µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Å—É–¥—å–±—ã, –ª—é–±–≤–∏, –∫–∞—Ä—å–µ—Ä—ã –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –ø—É—Ç–∏."
    )
    interpretation = ask_openai(prompt)
    return f"üé¥ **–í–∞—à–∞ –∫–∞—Ä—Ç–∞ –¢–∞—Ä–æ: {card}**\n\n{interpretation}"

def ask_openai(prompt: str) -> str:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ OpenAI API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏.
    """
    try:
        # –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± —Ä–∞–±–æ—Ç—ã —Å OpenAI API (–≤–µ—Ä—Å–∏—è 1.0+)
        response = openai.chat.Completion.create(
            model="gpt-3.5-turbo",  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥–µ–ª—å GPT-3.5 –∏–ª–∏ GPT-4
            messages=[
                {"role": "system", "content": 
                 "–¢—ã —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –≥–æ—Ä–æ—Å–∫–æ–ø–∞–º–∏, –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏–µ–π, –¢–∞—Ä–æ –∏ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏–µ–π. "
                 "–¢—ã –º–æ–∂–µ—à—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –∫–∞—Ä—Ç –¢–∞—Ä–æ, —Ä–∞—Å—á–µ—Ç—ã —á–∏—Å–µ–ª —Å—É–¥—å–±—ã –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è, –∞–Ω–∞–ª–∏–∑—ã –Ω–∞—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç, "
                 "–≥–æ—Ä–æ—Å–∫–æ–ø—ã –Ω–∞ –¥–µ–Ω—å, –Ω–µ–¥–µ–ª—é –∏–ª–∏ –º–µ—Å—è—Ü, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Å—Ç—Ä–æ–ª–æ–≥–∏–∏. –í—Å–µ —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏, "
                 "–º–∏—Å—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º–∏, –ø–æ–º–æ–≥–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç—å —Å–≤–æ—é —Å—É–¥—å–±—É –∏ –∂–∏–∑–Ω—å. –¢—ã –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é "
                 "–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç –ª—é–¥—è–º –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–≤–æ—é –∂–∏–∑–Ω—å, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∫–∞—Ä—å–µ—Ä—É –∏ –¥—É—Ö–æ–≤–Ω—ã–π –ø—É—Ç—å."},
                {"role": "user", "content": prompt}
            ],
            max_tokens=150,
            temperature=0.7,
        )
        return response['choices'][0]['message']['content'].strip()  # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞
    except Exception as e:
        return f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: {e}"

def get_natal_chart(name: str, birth_date: str, birth_time: str, birth_place: str) -> str:
    """–ó–∞–ø—Ä–æ—Å –∫ OpenAI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã."""
    prompt = (
        f"–°–æ–∑–¥–∞–π —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã –¥–ª—è {name}. "
        f"–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_date}, –í—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è: {birth_time}, –ú–µ—Å—Ç–æ: {birth_place}. "
        "–û–ø–∏—à–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, —Å–∫—Ä—ã—Ç—ã–µ —Ç–∞–ª–∞–Ω—Ç—ã –∏ –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è —Å—É–¥—å–±—ã."
    )
    return ask_openai(prompt)
