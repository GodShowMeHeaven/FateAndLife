import random
from openai import OpenAI
from services.openai_service import ask_openai

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI –∫–ª–∏–µ–Ω—Ç–∞
client = OpenAI()

# –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç –¢–∞—Ä–æ
tarot_cards = [
    "–®—É—Ç", "–ú–∞–≥", "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä",
    "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "–û—Ç—à–µ–ª—å–Ω–∏–∫",
    "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "–°–∏–ª–∞", "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "–°–º–µ—Ä—Ç—å", "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
    "–î—å—è–≤–æ–ª", "–ë–∞—à–Ω—è", "–ó–≤–µ–∑–¥–∞", "–õ—É–Ω–∞", "–°–æ–ª–Ω—Ü–µ", "–°—É–¥", "–ú–∏—Ä"
]

async def get_tarot_interpretation():
    """–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É OpenAI –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –∫–∞—Ä—Ç—ã –¢–∞—Ä–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–µ–∫—Å—Ç."""
    card = random.choice(tarot_cards)
    prompt = (
        f"–¢—ã ‚Äî –¥—Ä–µ–≤–Ω–∏–π –º–∏—Å—Ç–∏–∫, —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å —Ç–∞–π–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π –∫–∞—Ä—Ç –¢–∞—Ä–æ, —Å–ø–æ—Å–æ–±–Ω—ã–π –ø—Ä–æ–Ω–∏–∫–∞—Ç—å —Å–∫–≤–æ–∑—å –∑–∞–≤–µ—Å—É —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. "
        f"–í –º–µ—Ä—Ü–∞—é—â–µ–º —Å–≤–µ—Ç–µ —Å–≤–µ—á–µ–π —Ç–≤–æ–∏ —Ä—É–∫–∏ –∫–∞—Å–∞—é—Ç—Å—è –∫–æ–ª–æ–¥—ã, –∏ –≤—ã—Å—à–∏–µ —Å–∏–ª—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –∫–∞—Ä—Ç—É: {card}. "
        f"–≠—Ç–∞ –∫–∞—Ä—Ç–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–∏–º–≤–æ–ª, –Ω–æ –ø–æ—Ä—Ç–∞–ª –≤ –∏–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è, –æ–∫–Ω–æ –≤ —Å—É–¥—å–±—É –≤–æ–ø—Ä–æ—à–∞—é—â–µ–≥–æ. "
        
        f"–†–∞—Å–∫—Ä–æ–π –≥–ª—É–±–∏–Ω–Ω—ã–π —Å–º—ã—Å–ª —ç—Ç–æ–≥–æ –º–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–Ω–∞–º–µ–Ω–∏—è –≤ —á–µ—Ç—ã—Ä—ë—Ö —Å–≤—è—â–µ–Ω–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö –±—ã—Ç–∏—è: "
        
        f"–í –ª–∞–±–∏—Ä–∏–Ω—Ç–∞—Ö –°—É–¥—å–±—ã ‚Äî –∫–∞–∫–∏–µ –Ω–∏—Ç–∏ –ú–æ–π—Ä —Å–ø–ª–µ—Ç–∞—é—Ç—Å—è –≤–æ–∫—Ä—É–≥ –¥—É—à–∏ –≤–æ–ø—Ä–æ—à–∞—é—â–µ–≥–æ? "
        f"–ö–∞–∫–∏–µ —Ç–∞–π–Ω—ã–µ –∑–Ω–∞–∫–∏ –∏ –ø—Ä–µ–¥–∑–Ω–∞–º–µ–Ω–æ–≤–∞–Ω–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç—Ç–∞ –∫–∞—Ä—Ç–∞? –ö–∞–∫–∏–µ –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏ "
        f"–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –Ω–µ—Å–µ—Ç –æ–Ω–∞ –∏–∑ –ø—Ä–æ—à–ª—ã—Ö –≤–æ–ø–ª–æ—â–µ–Ω–∏–π? –î–æ–±–∞–≤—å –ø—Ä–æ—Ä–æ—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ –æ –±—É–¥—É—â–µ–º, "
        f"–∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–≤–µ—Å—É –≤—Ä–µ–º–µ–Ω–∏. "
        
        f"–í —Å–∞–¥–∞—Ö –õ—é–±–≤–∏ ‚Äî –∫–∞–∫ —ç–Ω–µ—Ä–≥–∏–∏ –∫–∞—Ä—Ç—ã –≤–ª–∏—è—é—Ç –Ω–∞ —Å–µ—Ä–¥–µ—á–Ω—É—é —á–∞–∫—Ä—É –∏ –ª—é–±–æ–≤–Ω—ã–µ —Å–≤—è–∑–∏? "
        f"–ö–∞–∫–∏–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Ç–æ–∫–∏ —Å–æ–µ–¥–∏–Ω—è—é—Ç –∏–ª–∏ —Ä–∞–∑—ä–µ–¥–∏–Ω—è—é—Ç —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥—É—à–∏? "
        f"–ö–∞–∫–∏–µ —Å–∫—Ä—ã—Ç—ã–µ –∂–µ–ª–∞–Ω–∏—è –∏ —Å—Ç—Ä–∞—Å—Ç–∏ –ø—Ä–æ–±—É–∂–¥–∞—é—Ç—Å—è –ø–æ–¥ –≤–ª–∏—è–Ω–∏–µ–º —ç—Ç–æ–π –∫–∞—Ä—Ç—ã? "
        
        f"–ù–∞ –ø—É—Ç—è—Ö –í–ª–∞—Å—Ç–∏ –∏ –£—Å–ø–µ—Ö–∞ ‚Äî –∫–∞–∫–∏–µ –≤—Ä–∞—Ç–∞ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞? "
        f"–ö–∞–∫–∏–µ —Ç–∞–ª–∞–Ω—Ç—ã –∏ –¥–∞—Ä—ã –¥—Ä–µ–º–ª—é—Ç –≤ –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–∏, –æ–∂–∏–¥–∞—è –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è? "
        f"–ö–∞–∫–∏–µ —Ç–∞–π–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –ø–æ–º–æ–≥—É—Ç –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –∏ –¥–æ—Å—Ç–∏—á—å –≤–µ—Ä—à–∏–Ω? "
        
        f"–í —Ö—Ä–∞–º–µ –î—É—Ö–∞ ‚Äî –∫–∞–∫–∏–µ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ —Ü–µ–Ω—Ç—Ä—ã –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —ç—Ç–æ–π –∫–∞—Ä—Ç–æ–π? "
        f"–ö–∞–∫–∏–µ –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ä–∏—Ç—É–∞–ª—ã —É—Å–∏–ª—è—Ç —Å–≤—è–∑—å —Å –≤—ã—Å—à–∏–º–∏ —Å–∏–ª–∞–º–∏? "
        f"–ö–∞–∫–∏–µ –¥—É—Ö–æ–≤–Ω—ã–µ —É—á–∏—Ç–µ–ª—è –∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∏ –º–æ–≥—É—Ç —è–≤–∏—Ç—å—Å—è –∏–∑ —Ç–æ–Ω–∫–∏—Ö –º–∏—Ä–æ–≤? "
        
        f"–î–ª—è –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä—ã –¥–∞–π –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç, –∑–≤—É—á–∞—â–∏–π –∫–∞–∫ –¥—Ä–µ–≤–Ω–µ–µ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–æ –∏–ª–∏ —à–µ–ø–æ—Ç –¥—É—Ö–æ–≤. "
        
        f"–í –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞—Å–∫—Ä–æ–π —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–µ —Ç–∞–π–Ω—ã —ç—Ç–æ–π –∫–∞—Ä—Ç—ã ‚Äî —Å–≤—è–∑—å —Å –ø–ª–∞–Ω–µ—Ç–∞–º–∏, —Å—Ç–∏—Ö–∏—è–º–∏, "
        f"–∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏, –∞—Ä–æ–º–∞–º–∞—Å–ª–∞–º–∏, –¥–Ω—è–º–∏ –Ω–µ–¥–µ–ª–∏ –∏ –ª—É–Ω–Ω—ã–º–∏ —Ñ–∞–∑–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–∏—Ç—É–∞–ª–æ–≤. "
        f"–£–ø–æ–º—è–Ω–∏ —Å–≤—è—â–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —Ä—É–Ω—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç–Ω–µ—Ä–≥–∏–µ–π –∫–∞—Ä—Ç—ã. "
        
        f"–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π Markdown-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ###, **, *, # –∏ —Ç.–¥.). "
        f"–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:\n"
        f"- üåü –ø–µ—Ä–µ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'üåü –°—É–¥—å–±–∞').\n"
        f"- üí° –ø–µ—Ä–µ–¥ —Å–æ–≤–µ—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'üí° –°–æ–≤–µ—Ç: ...').\n"
        f"- üîÆ –ø–µ—Ä–µ–¥ —Ä–∞–∑–¥–µ–ª–æ–º —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'üîÆ –≠–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏').\n"
        f"–ü–∏—à–∏ —Ç–µ–∫—Å—Ç, –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —ç–Ω–µ—Ä–≥–∏–µ–π —Ç–∞–π–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ—ç—Ç–∏—á–Ω—ã–π, –æ–±—Ä–∞–∑–Ω—ã–π —è–∑—ã–∫ –¥—Ä–µ–≤–Ω–∏—Ö –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤."
    )
    interpretation = await ask_openai(prompt)  # –î–æ–±–∞–≤–ª–µ–Ω await –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    return card, interpretation

def generate_tarot_image(card: str) -> str:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –¢–∞—Ä–æ —á–µ—Ä–µ–∑ OpenAI DALL¬∑E 3."""
    try:
        response = client.images.generate(
            model="dall-e-3",
            prompt=f"A mystical, ethereal Tarot card illustration of {card} in an ancient, ornate style with magical symbols, cosmic elements, and mystical energies. The image should appear as if from an ancient grimoire, with rich details, gold accents, and a sense of profound mystery. Add esoteric symbols around the edges and magical auras.",
            size="1024x1024",
            quality="standard",
            n=1
        )
        return response.data[0].url
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
        return None