import random
from openai import OpenAI
from services.openai_service import ask_openai

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenAI –∫–ª–∏–µ–Ω—Ç–∞
client = OpenAI()

# –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç –¢–∞—Ä–æ
tarot_cards = [
    "–®—É—Ç", "–ú–∞–≥", "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –ñ—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞", "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä",
    "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç", "–í–ª—é–±–ª–µ–Ω–Ω—ã–µ", "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "–û—Ç—à–µ–ª—å–Ω–∏–∫",
    "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã", "–°–∏–ª–∞", "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π", "–°–º–µ—Ä—Ç—å", "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
    "–î—å—è–≤–æ–ª", "–ë–∞—à–Ω—è", "–ó–≤–µ–∑–¥–∞", "–õ—É–Ω–∞", "–°–æ–ª–Ω—Ü–µ", "–°—É–¥", "–ú–∏—Ä"
]

async def get_tarot_interpretation():
    """–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É OpenAI –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –∫–∞—Ä—Ç—ã –¢–∞—Ä–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–µ–∫—Å—Ç."""
    card = random.choice(tarot_cards)
    prompt = (
        f"–í—ã—Ç–∞—â–∏ –∫–∞—Ä—Ç—É –¢–∞—Ä–æ: {card}. –û–ø–∏—à–∏ –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —á–µ—Ç—ã—Ä—ë—Ö —Å—Ñ–µ—Ä–∞—Ö: —Å—É–¥—å–±–∞, –ª—é–±–æ–≤—å, –∫–∞—Ä—å–µ—Ä–∞ –∏ –¥—É—Ö–æ–≤–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ. "
        f"–î–ª—è –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä—ã –¥–æ–±–∞–≤—å —Å–æ–≤–µ—Ç. –í –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤—å —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏. "
        f"–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π Markdown-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ###, **, *, # –∏ —Ç.–¥.). "
        f"–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:\n"
        f"- üåü –ø–µ—Ä–µ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–π —Å—Ñ–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'üåü –°—É–¥—å–±–∞').\n"
        f"- üí° –ø–µ—Ä–µ–¥ —Å–æ–≤–µ—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'üí° –°–æ–≤–µ—Ç: ...').\n"
        f"- üîÆ –ø–µ—Ä–µ–¥ —Ä–∞–∑–¥–µ–ª–æ–º —ç–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'üîÆ –≠–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏').\n"
        f"–ü–∏—à–∏ —Ç–µ–∫—Å—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫—Ä–æ–º–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —ç–º–æ–¥–∑–∏."
    )
    interpretation = await ask_openai(prompt)  # –î–æ–±–∞–≤–ª–µ–Ω await –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
    return card, interpretation

def generate_tarot_image(card: str) -> str:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –¢–∞—Ä–æ —á–µ—Ä–µ–∑ OpenAI DALL¬∑E 3."""
    try:
        response = client.images.generate(
            model="dall-e-3",
            prompt=f"A mystical Tarot card illustration of {card} in a detailed fantasy style.",
            size="1024x1024",
            quality="standard",
            n=1
        )
        return response.data[0].url
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
        return None